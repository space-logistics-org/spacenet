<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Elements</title>
  <meta name="author" content="SpaceNet Team">
  <meta name="description" content="An editor for SpaceNet database objects.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.3.1/jszip-2.5.0/dt-1.10.25/af-2.3.7/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/b-print-1.7.1/cr-1.5.4/date-1.1.0/fc-3.3.3/fh-3.1.9/kt-2.6.2/r-2.2.8/rg-1.1.3/rr-1.2.8/sc-2.0.4/sb-1.1.0/sp-1.3.0/sl-1.3.3/datatables.min.css"/>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="style.css" rel="stylesheet">
  <script src="element_formview.js"></script>

</head>

<body>
  <div class="container py-4">
    <header class="pb-3 mb-4 border-bottom">
      <a class="d-flex align-items-center text-dark text-decoration-none"></a>
        <img src = "SpaceNetLogo.jpg" height="30px">
        <span class="fs-4">SpaceNet</span>
    </header>
    <h1 class="text-dark" class="display-5">Elements</h1>

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addModal">Add Element</button>
    <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="addModal">Add New Element</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
          <div class="text-center" class="dropdown">
            <label for="dropPick">Element Type</label>
              <form id="element">
                <select id="dropPick" onChange = "formSet()" class="form-control" class="text-center">
                  <option selected id="def">Choose...</option>
                  <option id="Element">Element</option>
                  <option id="ResourceContainer">Resource Container</option>
                  <option id="ElementCarrier">Element Carrier</option>
                  <option id="HumanAgent">Human Agent</option>
                  <option id="RoboticAgent">Robotic Agent</option>
                  <option id="PropulsiveVehicle">Propulsive Vehicle</option>
                  <option id="SurfaceVehicle">Surface Vehicle</option>
                </select>
              </form>
            </div>
            <hr></hr>
              <form id="components">
                <div class="form-row">
                  <div class="form-group col-md-6">
                    <label for="inputName">Name</label>
                    <input type="text" class="form-control" id="inputName" placeholder="Element Name">
                  </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="inputCOS">Class of Supply</label>
                  <select id="inputCOS" onChange="subclassSet()" class="form-control" >
                    <option selected>Choose...</option>
                    <option id="0">None</option>
                    <option id="1">Propellants and Fuels</option>
                    <option id="2">Crew Provisions</option>
                    <option id="3">Crew Operations</option>
                    <option id="4">Maintenence and Upkeep</option>
                    <option id="5">Stowage and Restraint</option>
                    <option id="6">Exploration and Research</option>
                    <option id="7">Waste and Disposal</option>
                    <option id="8">Habitation and Infrastructure</option>
                    <option id="9">Transportation and Carriers</option>
                    <option id="10">Miscellaneous</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <label for="inputCOSSub1">Class of Supply Subclass</label>
                  <select id="inputCOSSub1" class="form-control">
                    <option selected>Choose...</option>
                    <option id="101">Cryogens</option>
                    <option id="102">Hypergols</option>
                    <option id="103">Nuclear Fuel</option>
                    <option id="104">Petroleum Fuels</option>
                    <option id="105">Other Fuels</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub2" class="form-control">
                    <option selected>Choose...</option>
                    <option id="201">Water and Support Equipment</option>
                    <option id="202">Food and Support Equipment</option>
                    <option id="203">Gases</option>
                    <option id="204">Hygiene Items</option>
                    <option id="205">Clothing</option>
                    <option id="206">Personal Items</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub3" class="form-control">
                    <option selected>Choose...</option>
                    <option id="301">Office Equipment and Supplies</option>
                    <option id="302">EVA Equipment and Consumables</option>
                    <option id="303">Health Equipment and Consumables</option>
                    <option id="304">Safety Equipment</option>
                    <option id="305">Communications Equipment</option>
                    <option id="306">Computers and Support Equipment</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub4" onChange="subSelect4()" class="form-control" >
                    <option selected>Choose...</option>
                    <option id="401">Spares and Repair Parts</option>
                    <option id="402">Maintenance Tools</option>
                    <option id="403">Lubricants and Bulk Chemicals</option>
                    <option id="404">Batteries</option>
                    <option id="405">Cleaning Equipment and Consumables</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub5" class="form-control">
                    <option selected>Choose...</option>
                    <option id="501">Cargo Containers and Restraints</option>
                    <option id="502">Inventory Management Equipment</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub6" class="form-control">
                    <option selected>Choose...</option>
                    <option id="601">Science Payloads and Instruments</option>
                    <option id="602">Field Equipment</option>
                    <option id="603">Samples</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub7" class="form-control">
                    <option selected>Choose...</option>
                    <option id="701">Waste</option>
                    <option id="702">Waste Management Equipment</option>
                    <option id="703">Failed Pairs</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub8" onChange="subSelect8()" class="form-control">
                    <option selected>Choose...</option>
                    <option id="801">Habitation Facilities</option>
                    <option id="802">Surface Mobility Systems</option>
                    <option id="803">Power Systems</option>
                    <option id="804">Robotic Systems</option>
                    <option id="805">Resource Utilization Systems</option>
                    <option id="806">Orbiting Service Systems</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub9" onChange="subSelect9()" class="form-control">
                    <option selected>Choose...</option>
                    <option id="901">Carriers, Non-propulsive Elements</option>
                    <option id="902">Propulsive Elements</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub4Sub" class="form-control">
                    <option selected>Choose...</option>
                    <option id="4011">Spares</option>
                    <option id="4012">Repair Parts</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub8Sub" class="form-control">
                    <option selected>Choose...</option>
                    <option id="8041">Science Robotics</option>
                    <option id="8042">Construction/Maintenance Robotics</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <select id="inputCOSSub9Sub" class="form-control">
                    <option selected>Choose...</option>
                    <option id="9021">Launch Vehicles</option>
                    <option id="9022">Upper Stages/In-Space Propulsion Systems</option>
                    <option id="9023">Descent Stages</option>
                    <option id="9024">Ascent Stages</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="inputEnv">Environment</label>
                  <select id="inputEnv" class="form-control">
                    <option selected>Choose...</option>
                    <option id="pres">Pressurized</option>
                    <option id="unpres">Unpressurized</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label for="inputAccMass">Accomodation Mass</label>
                  <input type="number" class="form-control" id="inputAccMass" placeholder="Accomodation Mass">
                </div>
                <div class="form-group col-md-4">
                  <label for="inputMass">Mass</label>
                  <input type="number" class="form-control" id="inputMass" placeholder="Mass">
                </div>
                <div class="form-group col-md-4">
                  <label for="inputVol">Volume</label>
                  <input type="number" class="form-control" id="inputVol" placeholder="Mass">
                </div>
              </div>
              <hr></hr>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="inputCarMass">Cargo Mass</label>
                  <input type="number" class="form-control" id="inputCarMass" placeholder="Cargo Mass">
                </div>
                <div class="form-group col-md-6">
                  <label for="inputCarVols">Cargo Volume</label>
                  <input type="number" class="form-control" id="inputCarVol" placeholder="Cargo Volume">
                </div>
                <div class="form-group col-md-6">
                  <label for="inputATF">Active Time Fraction</label>
                  <input type="text" class="form-control" id="inputATF" placeholder="Active Time Fraction">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="inputMaxCrew">Maximum Crew Count</label>
                  <input type="number" class="form-control" id="inputMaxCrew" placeholder="Maximum Crew">
                </div>
                <div class="form-group col-md-6">
                  <label for="inputSpecImp">Specific Impulse</label>
                  <input type="number" class="form-control" id="inputSpecImp" placeholder="Specific Impulse">
                </div>
                <div class="form-group col-md-6">
                  <label for="inputMaxFuel">Maximum Fuel</label>
                  <input type="number" class="form-control" id="inputMaxFuel" placeholder="Maximum Fuel">
                </div>
                <!-- Look for Propellant ID? Once schema confirmed determine the correct form view -->
                <div class="form-group col-md-6">
                  <label for="inputMaxSpeed">Maximum Speed</label>
                  <input type="number" class="form-control" id="inputMaxSpeed" placeholder="Maximum Speed">
                </div>
                <!-- Look for Fuel ID? Once schema confirmed determine the correct form view -->
              </div>
              <button type="submit" class="btn btn-primary">Submit Element</button>
            </form>

          </div>
      </div>
        </div>
      </div>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  


    <div>
      <table id="elements_table" class="table table-striped table-bordered" style="width: 100%">
        <thead class="thead-dark">
            <tr>
                <th> </th>
                <th>Name</th>
                <th>Type</th>
                <th>Class of Supply</th>
                <th>Environment</th>
                <th>Accomodation Mass</th>
                <th>Mass</th>
                <th>Volume</th>
                <!-- <th>Max Crew</th> -->
                <!-- <th>Cargo Mass</th>
                <th>Cargo Volume</th>
                <th>Cargo Environment</th>
                <th>Active Fraction</th>
                <th>OMS ISP</th>
                <th>Max OMS</th>
                <th>RCS ISP</th>
                <th>Mas RCS</th>
                <th>RCS ID</th>
                <th>Max Speed</th>
                <th>Max Fuel</th>
                <th>Fuel ID</th> -->
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
          <tr>
            <th></th>
            <th>Name</th>
            <th>Type</th>
            <th>Class of Supply</th>
            <th>Environment</th>
            <th>Accomodation Mass</th>
            <th>Mass</th>
            <th>Volume</th>
            <!-- <th>Max Crew</th>
            <th>Cargo Mass</th>
            <th>Cargo Volume</th>
            <th>Cargo Environment</th>
            <th>Active Fraction</th>
            <th>OMS ISP</th>
            <th>Max OMS</th>
            <th>RCS ISP</th>
            <th>Mas RCS</th>
            <th>RCS ID</th>
            <th>Max Speed</th>
            <th>Max Fuel</th>
            <th>Fuel ID</th> -->
            <th>Description</th>
          </tr>
        </tfoot>
      </table>

    </div>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4-4.6.0/jq-3.3.1/jszip-2.5.0/dt-1.10.25/af-2.3.7/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/b-print-1.7.1/cr-1.5.4/date-1.1.0/fc-3.3.3/fh-3.1.9/kt-2.6.2/r-2.2.8/rg-1.1.3/rr-1.2.8/sc-2.0.4/sb-1.1.0/sp-1.3.0/sl-1.3.3/datatables.min.js"></script>

    <script>
        $(document).ready(function () {
          $('#elements_table tfoot th').each(function() {
            if ($(this).index() !== 0) {
              var title = $(this).text();
              $(this).html('<input type="text" placeholder="Search ' + title + '" />');
            }
          });

          $.fn.dataTable.ext.buttons.delete = {
              extend: 'selected',
              text: '<span data-customTooltip="Select row(s) to delete">Delete</span>',
              className: 'btn-style',
              action: function ( e, dt, node, config ) {
                var record = table.rows( { selected: true } ).data();
                console.log(record);
                console.log(record.length);
                for (i=0; i < record.length; i++) {
                  var element = record[i]
                  console.log(element)
                  $.ajax({
                      url: "/database/api/element/" + element.id,
                      method: "DELETE",
                      success: function(data) {
                        dt.ajax.reload();
                    }
                  });
                }
              }
          };

          $.fn.dataTable.ext.buttons.edit = {
              extend: 'selectedSingle',
              text: '<span data-customTooltip="Select 1 row to edit">Edit</span>',
              className: 'btn-style',
              action: function ( e, dt, node, config ) {
                var record = table.rows( { selected: true } ).data()[0];
                console.log(record)
                $.ajax({
                  url: "/database/api/element/" + record.id,
                  data: JSON.stringify({
                    message: prompt("Your message:", "Hello World")
                  }),
                  contentType: 'application/json; charset=utf-8',
                  dataType: "json",
                  method: "PUT",
                  success: function(item) {
                    dt.ajax.reload();
                  }
                });     
              }
          };

          $.fn.dataTable.ext.buttons.add = {
              text: 'Add Element',
              className: 'btn-style',
              action: function ( e, dt, node, config ) {
                $.ajax({
                  url: "/database/api/element/",
                  data: JSON.stringify({
                    message: prompt("Your message:", "Hello World")
                  }),
                  contentType: 'application/json; charset=utf-8',
                  dataType: "json",
                  method: "POST",
                  success: function(item) {
                    dt.ajax.reload();
                  }
                });
              }
          };

          $.fn.dataTable.ext.buttons.export = {
            extend: 'excel',
            text: 'Export',
            className: 'btn-style',
          }

          $.fn.dataTable.ext.buttons.filter = {
            extend: 'searchBuilder',
            text: 'Apply Filter',
            className: 'btn-style',
          }

          var table = $(elements_table).DataTable( {
            scrollX: true,
            ajax: {
              url: "/database/api/element/",
              dataSrc: ''
            },
            columns: [
              {data: null},
              { data: 'name' },
              { data: 'type' },
              { data: 'class_of_supply' },
              { data: 'environment' },
              { data: 'accommodation_mass' },
              { data: 'mass' },
              { data: 'volume' },
              { data: 'description' }
                ],
            buttons: [
                'export',
                'filter',
                'add',
                'edit',
                'delete',
            ],
            language: {
              searchBuilder: {
                button: {
                      0: 'Apply Filters',
                      1: 'Filters (one selected)',
                      _: 'Filters (%d)'
                  },
                add: 'Add Filter',
                title: 'Apply Custom Filters',
                data: 'Property',
              }
          },
            dom: 'BQlfrtip',
            columnDefs: [ 
            {
              targets:   0,
              searchable: false,
              orderable: false,
              defaultContent: '',
              className: 'select-checkbox',
              width: '8%',
            },
            ],
            select: {
                style:    'multi',
                selector: 'td:first-child'
            },
            order: [[ 1, 'asc' ]],
          });

          table.on( 'select deselect', function ( e, dt, type, indexes ) {
            console.log("selected something")
              var num_selected = table.rows( { selected: true } ).data().length;
              if (num_selected === 0) {
                dt.buttons([4]).text('<span data-customTooltip="Select row(s) to delete">Delete</span>')
                dt.buttons([3]).text('<span data-customTooltip="Select 1 row to edit">Edit</span>')
              } else if (num_selected === 1) {
                dt.buttons([4]).text('Delete row')
                dt.buttons([3]).text('Edit row')
              }
              else {
                dt.buttons([4]).text('Delete ' + num_selected + ' rows')
                dt.buttons([3]).text('<span data-customTooltip="Select 1 row to edit">Edit</span>')
              }
          } );
          
          table.columns().every( function() {
            var that = this;
      
            $('input', this.footer()).on('keyup change', function() {
                if (that.search() !== this.value) {
                    that
                        .search(this.value)
                        .draw();
                }
            });
          });
          });

    </script>
      <footer class="pt-3 mt-4 text-muted border-top">
        &copy; 2021
      </footer>
    </div>
</body>


</html>