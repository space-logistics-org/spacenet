<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Bat Chart Visualization</title>
  <meta name="author" content="SpaceNet Team">
  <meta name="description" content="A bat chart visualization of missions and campaigns.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

</head>

<main>
<div class="container py-4">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.3.2/chart.js" integrity="sha512-CAv0l04Voko2LIdaPmkvGjH3jLsH+pmTXKFoyh5TIimAME93KjejeP9j7wSeSRXqXForv73KUZGJMn8/P98Ifg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.27.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@0.2.1"></script>
    <script src="bat_chart_parsing.js"></script>
    <h1 class='text-center'>Scenario Bat Chart Visualization</h1>
    <canvas id="batChart"></canvas>

    <script>

        var apollo_17 = {
            name: 'Apollo 17',
            startDate: "1972-12-05T12:53",
            events: [
                {
                    name: "Create Apollo 17 Saturn-V Stack at KSC",
                    type: "Create Elements",
                    time: 0,
                    priority: 1,
                    node: {
                        name: 'KSC',
                        id: 1
                    }
                },
                {
                    name: "Create crew members in the CSM",
                    type: "Create Elements",
                    time: 0,
                    priority: 2,
                    node: {
                        name: 'KSC',
                        id: 1
                    }
                },
                {
                    name: "Launch to LEO",
                    type: "Space Transport",
                    time: 0,
                    priority: 3,
                    edge: {
                        name: 'KSC-LEO',
                        origin_node: {
                            name: 'KSC',
                            id: 1
                        },
                        destination_node: {
                            name: 'LEO',
                            id: 3
                        },
                        duration: 0.25,
                    }
                },
                {
                    name: "Translunar Injection",
                    type: 'Space Transport',
                    time: 0,
                    priority: 3,
                    edge: {
                        name: "LEO-28 km Lunar Orbit",
                        origin_node: {
                            name: 'LEO',
                            id: 3
                        },
                        destination_node: {
                            name: '28 km Lunar Orbit',
                            id: 4
                        },
                        duration: 3.5,
                    }
                },
                {
                    name: "1st descent orbit insertion",
                    type: "Space Transport",
                    time: 0,
                    priority: 1,
                    edge: {
                        name: "28 km to 11.5 km lunar orbit",
                        origin_node: {
                            name: '28 km Lunar Orbit',
                            id: 4
                        },
                        destination_node: {
                            name: '11.5 km Lunar Orbit',
                            id: 5
                        },
                        duration: 0.1,
                    }
                },
                {
                    name: "Move crew to LM",
                    time: 0,
                    priority: 1,
                    node: {
                        name: '11.5 km Lunar Orbit',
                        id: 5
                    }
                },
                {
                    name: 'Lunar Descent',
                    type: "Space Transport",
                    time: 0,
                    priority: 1,
                    edge: {
                        name: "11.5 km orbit-Taurus-Littrow",
                        origin_node: {
                            name: "11.5 km Lunar Orbit",
                            id: 5
                        },
                        destination_node: {
                            name: 'Taurus-Littrow',
                            id: 6
                        },
                        duration: 0.1,
                    }
                },
                {
                    name: "Apollo 17 crewed exploration",
                    type: "Crewed Exploration",
                    time: 0,
                    priority: 1,
                    edge: {
                        name: 'Crewed Exploration',
                        origin_node: {
                            name: 'Taurus-Littrow',
                            id: 6
                        },
                        destination_node: {
                            name: 'Taurus-Littrow',
                            id: 6
                        },
                        duration: 3,
                    }
                },
                {
                    name: "Transfer Crew to Lunar AM",
                    type: "Move Elements",
                    time: 0,
                    priority: 2,
                    node: {
                        name: 'Taurus-Littrow',
                        id: 6
                    }
                },
                {
                    name: 'Lunar ascent',
                    type: "Space Transport",
                    time: 0,
                    priority: 2,
                    edge: {
                        name: "Taurus-Littrow-11.5 km orbit",
                        origin_node: {
                            name: 'Taurus-Littrow',
                            id: 6
                        },
                        destination_node: {
                            name: '11.5 km Lunar Orbit',
                            id: 5
                        },
                        duration: 0.1,
                    }
                },
                {
                    name: "Move crew to CM",
                    type: "Move Elements",
                    time: 0,
                    priority: 1,
                    node: {
                        name: '11.5 km Lunar Orbit',
                        id: 5
                    }
                },
                {
                    name: "Transearth injection",
                    type: "Space Transport",
                    time: 0,
                    priority: 1,
                    edge: {
                        name: "Lunar orbit to Pacific Splashdown",
                        origin_node: {
                            name: "11.5 km Lunar Orbit",
                            id: 5
                        },
                        destination_node: {
                            name: "Pacific Splashdown",
                            id: 2
                        },
                        duration: 2.83,
                    }
                }


            ]
        }


        // var lunar_sortie = {
        //     name: 'Lunar Sortie',
        //     startDate: '2021-07-09',
        //     events: [
        //         {
        //             name: 'Create Elements',
        //             time: 0,
        //             priority: 1,
        //             node: {
        //                 name: 'KSC',
        //                 id: 1
        //             }
        //         },
        //         {
        //             name: 'Space Transport',
        //             time: 0,
        //             priority: 3,
        //             edge: {
        //                 name: 'KSC-LEO',
        //                 origin_node: {
        //                     name: 'KSC',
        //                     id: 1
        //                 },
        //                 destination_node: {
        //                     name: 'LEO',
        //                     id: 3
        //                 },
        //                 duration: 0.25,
        //             }
        //         },
        //         {
        //             name: 'Space Transport',
        //             time: 0,
        //             priority: 3,
        //             edge: {
        //                 name: 'LEO-LLPO',
        //                 origin_node: {
        //                     name: 'LEO',
        //                     id: 3
        //                 },
        //                 destination_node: {
        //                     name: 'LLPO',
        //                     id: 4
        //                 },
        //                 duration: 4.0,
        //             }
        //         },
        //         {
        //             name: 'Move Elements',
        //             time: 0,
        //             priority: 1,
        //             node: {
        //                 name: 'LLPO',
        //                 id: 4
        //             }
        //         },
        //         {
        //             name: 'Space Transport',
        //             time: 0,
        //             priority: 3,
        //             edge: {
        //                 name: 'LLPO-LSP',
        //                 origin_node: {
        //                     name: 'LLPO',
        //                     id: 4
        //                 },
        //                 destination_node: {
        //                     name: 'LSP',
        //                     id: 5
        //                 },
        //                 duration: 0.5,
        //             }
        //         },
        //         {
        //             name: 'Crewed Exploration',
        //             time: 0,
        //             priority: 1,
        //             edge: {
        //                 name: 'Crewed Exploration',
        //                 origin_node: {
        //                     name: 'LSP',
        //                     id: 5
        //                 },
        //                 destination_node: {
        //                     name: 'LSP',
        //                     id: 5
        //                 },
        //                 duration: 7.5,
        //             }
        //         },
        //         {
        //             name: 'Create Elements',
        //             time: 0,
        //             priority: 1,
        //             node: {
        //                 name: 'LSP',
        //                 id: 5
        //             }
        //         },
        //         {
        //             name: 'Space Transport',
        //             time: 0,
        //             priority: 3,
        //             edge: {
        //                 name: 'LSP-LLPO',
        //                 origin_node: {
        //                     name: 'LSP',
        //                     id: 5
        //                 },
        //                 destination_node: {
        //                     name: 'LLPO',
        //                     id: 4
        //                 },
        //                 duration: 0.5,
        //             }
        //         },
        //         {
        //             name: 'Move Elements',
        //             time: 0,
        //             priority: 1,
        //             node: {
        //                 name: 'LLPO',
        //                 id: 4
        //             }
        //         },
        //         {
        //             name: 'Space Transport',
        //             time: 0,
        //             priority: 3,
        //             edge: {
        //                 name: 'LLPO-PAC',
        //                 origin_node: {
        //                     name: 'LLPO',
        //                     id: 4
        //                 },
        //                 destination_node: {
        //                     name: 'PAC',
        //                     id: 2
        //                 },
        //                 duration: 4,
        //             }
        //         }


        //     ]
        // }

        var missions = [apollo_17]

        var all_data = [];
        var nodeNames = {};
        missions.forEach(function(item) {
            var parsed = parseMission(item);
            $.extend(nodeNames, parsed[0]);
            parsed[1].forEach(function(dataset) {
                all_data.push(dataset)
            })
        })

        const data = {
            datasets: all_data
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false,
                    },
                    title: {
                        display: false,
                        text: 'Scenario'
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                var label = context.dataset.label || '';

                                if (label) {
                                    label += ' (';
                                }
                                if (context.parsed.y !== null) {
                                    label += nodeNames[context.parsed.y];
                                    label += ')'
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            // Luxon format string
                            tooltipFormat: 'DD T'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        },
                    },
                    y: {
                        title: {
                        display: true,
                        text: 'Location'
                        },
                        ticks: {
                            callback: function(value, index, values) {
                                return nodeNames[value]
                            }
                        }
                    }
                },
            }
        };
        var myChart = new Chart(
            document.getElementById('batChart'),
            config
        );
    </script>





  <footer class="pt-3 mt-4 text-muted border-top">
    &copy; 2021
  </footer>
</div>
</main>

</html>
